(function(e,t,n,r){var i={url:null,onload:function(){},container:"",startWithRout:true,startPageSwitch:function(){},stopPageSwitch:function(){},routs:null,defaultAjaxParams:{},delay:0};var s="";var o=null;var u={};var a=[];var f=[];var l=[];var c=[];var h={method:"get",data:{}};var p="";var d={};var v=function(v){var m=function(n,r){i=e.extend({},i,n);if(i.url===null){throw"site url path is requierd"}if(i.routs===null){throw"you must define your router object"}if(i.container==""){throw"you must set a main container for your app"}E();if(o===null){o=r;r.addPage();History.Adapter.bind(t,"statechange",function(){r.router()});y();i.onload()}};var g=function(){if(i.startWithRout){var e="";if(i.url.slice(-1)=="/")e=i.url+o.getUrl();else{e=i.url+"/"+o.getUrl()}o.router(e)}};var y=function(){b();w()};var b=function(){e(n).on("vclick click","a",function(t){var n=e(this);$aVal=n.attr("href");if(n.attr("target")=="_blank"||$aVal==""||$aVal===r||$aVal.indexOf("#")==0||n.data("refresh")!==r){return true}var u=n.attr("href");if(s!=u.replace(i.url,"")){History.pushState(null,null,u)}else{o.router(u)}t.preventDefault();return false})};var w=function(){e(n).on("submit","form",function(t){var n=e(this);if(n.attr("enctype")==="multipart/form-data"){return true}var u=n.attr("action");h.method=n.attr("method")!==r?n.attr("method"):h.method;h.data=n.serializeObject();if(u===r||u==i.url+s){u=i.url+s;o.router(u)}History.pushState(null,null,u);t.preventDefault();return false})};var E=function(){s=t.location.href;s=s.replace(/#[^#]*$/,"").replace(/\?[^\?]*$/,"").replace(/^https:/,"http:").replace(i.url,"");if(s.slice(-1)=="/"){s=s.substr(0,s.lastIndexOf("/"))}if(s.indexOf("/")==0){s=s.substr(1)}p=s.indexOf("/")>-1?s.substr(0,s.indexOf("/")):s};var S=function(){for(var e in a){o.off(a[e])}a=[];for(var e in f){o.unbind(f[e])}f=[];o.deletePlugins();o.removeGlobals()};var x=function(){h={method:"get",data:{}}};this.errors=function(n,r){for(var i in r){switch(r[i]){case"string":if(typeof n!=="string"){throw"the variable "+n+"must be a string"}break;case"undefined":if(typeof n==="undefined"){throw"the variable "+n+"is undefined"}break;case"required":if(n.length===0){throw"the variable "+n+"is required"}break;case"array":if(!e.isArray(n)){throw"the variable "+n+"must be an array"}break;case"object":if(!e.isPlainObject(n)){throw"the variable "+n+"must be an object"}break;case"global":if(typeof t[n]!=="undefined"){throw"this variable: "+n+" is taken by the window object"}break}}};this.router=function(n){S();E();o.addPage();if(typeof i.routs[o.getPage()]!=="undefined"&&typeof i.routs[o.getPage()].settings=="function"){i.routs[o.getPage()].settings()}var r=typeof n!=="undefined"?{hashedUrl:n}:History.getState();h.data=e.extend({},h.data,{ajax_req:"yourwayjs"});var s={type:h.method,url:r.hashedUrl,data:h.data};if(!e.isEmptyObject(d)){s=e.extend({},s,d)}else if(!e.isEmptyObject(i.defaultAjaxParams)){s=e.extend({},s,i.defaultAjaxParams)}i=e.extend({},i,v);var u=e.ajax(s);x();i.startPageSwitch();var a=(new Date).getTime();u.done(function(n){var r=(new Date).getTime()-a;var s=r>=i.delay?0:i.delay-r;t.setTimeout(function(){e(i.container+" *").each(function(){e(this).off();e(this).unbind();e(this).removeNative()});if(typeof i.routs[o.getPage()]!=="undefined"&&typeof i.routs[o.getPage()].route=="function"){i.routs[o.getPage()].route(n)}else{i.routs["default"].route(n)}i.stopPageSwitch()},s);d={}});u.fail(function(n,r,s){var u=(new Date).getTime()-a;var f=u>=i.delay?0:i.delay-u;t.setTimeout(function(){e(i.container+" *").each(function(){e(this).off();e(this).unbind();e(this).removeNative()});if(typeof i.routs[o.getPage()]!=="undefined"&&typeof i.routs[o.getPage()].error=="function"){i.routs[o.getPage()].error(n,r,s)}else{i.routs["default"].error(n,r,s)}i.stopPageSwitch()},f);d={}});return false};this.addPage=function(){o.errors(s,Array("string"));u[s]={}};this.on=function(t,n,r){if(t instanceof jQuery){t.on(n,function(){r()})}else{e(t).on(n,function(){r()})}a.push(t)};this.off=function(t){if(t instanceof jQuery){t.off()}else{e(t).off()}};this.bind=function(t,n,r){if(t instanceof jQuery){t.bind(n,function(){r()})}else{e(t).bind(n,function(){r()})}f.push(t)};this.unbind=function(t){if(t instanceof jQuery){t.unbind()}else{e(t).unbind()}};this.addGlobals=function(e,n){o.errors(e,Array("global"));l.push(e);t[e]=n};this.removeGlobals=function(){for(var e in l){delete t[l[e]]}l=[]};this.addPlugin=function(e){c.push(e)};this.deletePlugins=function(){for(var e in c){c[e]()}c=[]};this.getUrl=function(){return s};this.getPage=function(){return p};this.setOneTimeAjaxParams=function(e){o.oneTimeAjaxParams=e};this.setDelay=function(e){delay=e};m(v,this);t["yourwayjs"]=o;g();return o};if(typeof define==="function"&&define.amd){define("yourwayjs",[],function(){return v})}})(jQuery,window,document)